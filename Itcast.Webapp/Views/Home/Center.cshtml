
@{
    Layout = null;
}

<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>Center</title>
    <link type="image/x-icon" href="/favicon.ico" />
    <link href="~/Content/bootstrap.min.css" rel="stylesheet" />
    <script src="~/Content/js/jquery-2.2.3.min.js"></script>
    <script src="~/Scripts/bootstrap.min.js"></script>
    <link href="~/Content/Center/style.css" rel="stylesheet" />
    <script src="~/Content/Center/theme-scripts.js"></script>
    @*<script src="~/Content/Center/SmoothScroll.js"></script>*@
    
    <link href="~/CanvasContent/css/fontello.css" rel="stylesheet" />
    <link href="~/CanvasContent/css/main.css" rel="stylesheet" />
    <link href="~/CanvasContent/css/style.css" rel="stylesheet" />
    <style>
        .imgs {
            height: 200px;
            width: 582px;
        }

        .txts {
            position: relative;
            bottom: 120px;
        }
        .effect-bubba {
            margin:0px;
            padding:0px;
        }
        .col-0-gutter {
            padding:1px;
            color:white;
        }
    </style>
</head>
<body>
    <div style="margin-left:30%;display:none;   ">
        <input type="button" onclick="window.parent.selectTest()" value="查看统测" class="btn btn-default">
        <input type="button" onclick="window.parent.selectMyTest()" value="自我测试" class="btn btn-default">
        <input type="button" onclick="window.parent.selectTopic()" value="题目一览" class="btn btn-default">
        <input type="button" onclick="window.parent.selectUserInfo()" value="个人信息" class="btn btn-default">
        <input type="button" onclick="window.parent.selectMsg()" value="消息" class="btn btn-default">
        <input type="button" onclick="window.parent.selectSecurity()" value="安全设置" class="btn btn-default">
    </div>
    <div class="container">
        <div class="row row-0-gutter">
            <div class="col-md-12 col-0-gutter">
                <div class="main grid">
                    <canvas id="canvas" width="500" height="100"></canvas>
                </div>
                </div>
                <!-- start portfolio item -->
                <div class="col-md-6 col-0-gutter" onclick="window.parent.selectTest()">
                    <div class="ot-portfolio-item">
                        <figure class="effect-bubba">
                            <img src="~/Content/Center/timg (1).jpg" alt="img02" class="img-responsive imgs" />
                            <figcaption>
                                <div class="txts">
                                    <h2>统测</h2>
                                    <p>正在进行的统测：@ViewData["IngTestNum"] &nbsp;&nbsp;已结束的统测：@ViewData["EndTestNum"]</p>
                                    @*<a href="#" data-toggle="modal" data-target="#Modal-1">View more</a>*@
                                </div>
                            </figcaption>
                        </figure>
                    </div>
                </div>
                <!-- end portfolio item -->
                <!-- start portfolio item -->
                <div class="col-md-6 col-0-gutter" onclick="window.parent.selectMyTest()">
                    <div class="ot-portfolio-item">
                        <figure class="effect-bubba">
                            <img src="~/Content/Center/timg (1).jpg" alt="img02" class="img-responsive imgs" />
                            <figcaption>
                                <div class="txts">
                                    <h2>自我测试</h2>
                                    <p>指定数量，随机题目</p>
                                    @*<a href="#" data-toggle="modal" data-target="#Modal-2">View more</a>*@
                                </div>
                            </figcaption>
                        </figure>
                    </div>
                </div>
                <!-- end portfolio item -->
            </div>
            <div class="row row-0-gutter">
                <!-- start portfolio item -->
                <div class="col-md-6 col-0-gutter" onclick="window.parent.selectTopic()">
                    <div class="ot-portfolio-item">
                        <figure class="effect-bubba">
                            <img src="~/Content/Center/timg (1).jpg" alt="img02" class="img-responsive imgs" />
                            <figcaption>
                                <div class="txts">
                                    <h2>题目一览</h2>
                                    <p>题目数量：@ViewData["TopicNum"]</p>
                                    @*<a href="#" data-toggle="modal" data-target="#Modal-3">View more</a>*@
                                </div>
                            </figcaption>
                        </figure>
                    </div>
                </div>
                <!-- end portfolio item -->
                <!-- start portfolio item -->
                <div class="col-md-6 col-0-gutter" onclick="window.parent.selectMsg()">
                    <div class="ot-portfolio-item">
                        <figure class="effect-bubba">
                            <img src="~/Content/Center/timg (1).jpg" alt="img02" class="img-responsive imgs" />
                            <figcaption>
                                <div class="txts">
                                    <h2>消息</h2>
                                    <p>查看发送的新消息</p>
                                    @*<a href="#" data-toggle="modal" data-target="#Modal-4">View more</a>*@
                                </div>
                            </figcaption>
                        </figure>
                    </div>
                </div>
                <!-- end portfolio item -->
            </div>
            <div class="row row-0-gutter">
                <!-- start portfolio item -->
                <div class="col-md-6 col-0-gutter" onclick="window.parent.selectUserInfo()">
                    <div class="ot-portfolio-item">
                        <figure class="effect-bubba">
                            <img src="~/Content/Center/timg (1).jpg" alt="img02" class="img-responsive imgs" />
                            <figcaption>
                                <div class="txts">
                                    <h2>个人信息</h2>
                                    <p>设置修改个人信息</p>
                                    @*<a href="#" data-toggle="modal" data-target="#Modal-5">View more</a>*@
                                </div>
                            </figcaption>
                        </figure>
                    </div>
                </div>
                <!-- end portfolio item -->
                <!-- start portfolio item -->
                <div class="col-md-6 col-0-gutter" onclick="window.parent.selectSecurity()">
                    <div class="ot-portfolio-item">
                        <figure class="effect-bubba">
                            <img src="~/Content/Center/timg (1).jpg" alt="img02" class="img-responsive imgs" />
                            <figcaption>
                                <div class="txts">
                                    <h2>安全设置</h2>
                                    <p>提升安全性</p>
                                    @*<a href="#" data-toggle="modal" data-target="#Modal-2">View more</a>*@
                                </div>
                            </figcaption>
                        </figure>
                    </div>
                </div>
                <!-- end portfolio item -->
            </div>
        </div>
    <script src="~/CanvasContent/js/stats.min.js"></script>
    <script src="~/CanvasContent/js/tween.js"></script>
    <script src="~/CanvasContent/js/util.js"></script>
    <script>
        $(function () {
            
        })
    </script>
    <script>
        var stats = new Stats(),
            canvas = document.getElementById("canvas"),
            ctx = canvas.getContext("2d"),
            img = null,
            W = canvas.width,
            H = canvas.height,
            mouse = {
                x: 0,
                y: 0
            },
            points = [],
            MAN = false,
            DRAG = 0.95, //扩散因子
            EASE = 0.25, //缓动因子
            THICKNESS = Math.pow(20, 2), //鼠标扩散范围
            start = 0,
            animateArray = [];

        stats.showPanel(0); // 0: fps, 1: ms, 2: mb, 3+: custom
        document.body.appendChild(stats.dom);

        class Particle {
            constructor(x, y, color, duration) {
                this.x = x;
                this.y = y;
                this.sx = x;
                this.sy = y;
                this.dx = x;
                this.dy = y;
                this.vx = 0;
                this.vy = 0;
                this.color = `rgba(${color.r},${color.g},${color.b},${color.a})`;
                this.time = new Date();
                this.duration = duration;
            }
            //初始化动画
            init() {
                if (new Date() - this.time > this.duration) return;
                this.x = Tween.Back.easeInOut(
                    new Date() - this.time,
                    this.dx,
                    this.sx - this.dx,
                    this.duration
                );
                this.y = Tween.Back.easeInOut(
                    new Date() - this.time,
                    this.dy,
                    this.sy - this.dy,
                    this.duration
                );
            }
            //鼠标位置扩散动画
            update() {
                //模拟鼠标滑动
                if (!MAN) {
                    var t = +new Date() * 0.001;
                    mouse.x =
                        W * 0.5 + Math.cos(t * 2.1) * Math.cos(t * 0.9) * W * 0.45;
                    mouse.y =
                        H * 0.5 +
                        Math.sin(t * 3.2) * Math.tan(Math.sin(t * 0.8)) * H * 0.45;
                }
                var dx = mouse.x - this.x,
                    dy = mouse.y - this.y,
                    d = dx * dx + dy * dy,
                    f = -THICKNESS / d,
                    t = 0;
                if (d < THICKNESS) {
                    t = Math.atan2(dy, dx);
                    this.vx += f * Math.cos(t);
                    this.vy += f * Math.sin(t);
                }
                this.x += (this.vx *= DRAG) + (this.sx - this.x) * EASE;
                this.y += (this.vy *= DRAG) + (this.sy - this.y) * EASE;
            }
            draw(ctx) {
                ctx.beginPath();
                ctx.fillStyle = this.color;
                ctx.arc(this.x, this.y, 1, 0, Math.PI * 2, false);
                ctx.fill();
            }
        }

        function drawImg() {
            var imgCanvas = document.createElement("canvas"),
                imgCtx = imgCanvas.getContext("2d");
            imgCanvas.width = 500;
            imgCanvas.height = 100;
            var gradient = ctx.createLinearGradient(0, 0, imgCanvas.width, 0); //线性渐变
            gradient.addColorStop(0, "hsla(0,70%,50%,1)");
            gradient.addColorStop(0.5, "hsla(240,70%,50%,1");
            gradient.addColorStop(1, "hsla(270,70%,50%,1)");

            imgCtx.fillStyle = gradient;
            imgCtx.textAlign = "center";
            imgCtx.textBaseLine = "middle";
            imgCtx.font = "50px bold Lucida Sans";

            var showText = "欢迎进入  统测系统";
            imgCtx.fillText(showText, imgCanvas.width / 2, imgCanvas.height / 2);
            return imgCanvas;
        }

        function getImageData() {
            img = drawImg();
            var imgData = img
                .getContext("2d")
                .getImageData(0, 0, img.width, img.height);

            // for(var i=0,len=imgData.data.length;i<len;i+=4){
            //  if(imgData.data[i+3]<128)continue;
            //  var x=Math.floor(i/4%img.width),
            //      y=Math.floor(i/4/img.width),
            //      color={
            //          r:imgData.data[i],
            //          g:imgData.data[i+1],
            //          b:imgData.data[i+2],
            //          a:imgData.data[i+3]
            //      };

            //  var point=new Particle(x,y,color,2000);
            //  point.dx=random(x-40,x+40);
            //  point.dy=random(y-80,y+80);
            //  points.push(point);
            // }

            for (var x = 0; x < img.width; x++) {
                for (var y = 0; y < img.height; y++) {
                    var i = (y * imgData.width + x) * 4,
                        color = {
                            r: imgData.data[i],
                            g: imgData.data[i + 1],
                            b: imgData.data[i + 2],
                            a: imgData.data[i + 3]
                        };

                    if (imgData.data[i + 3] < 128) continue;
                    var x1 = (W - img.width) / 2 + x,
                        y1 = (H - img.height) / 2 + y,
                        point = new Particle(x1, y1, color, 1200);

                    point.dx = random(x1 - 40, x1 + 40);
                    point.dy = random(y1 - 80, y1 + 80);
                    points.push(point);
                }
            }
        }

        getImageData();

        canvas.addEventListener("mousemove", function (e) {
            mouse = windowToCanvas(canvas, e.clientX, e.clientY);
            MAN = true;
        }, false);

        /**
         * 隔一段时间把粒子添加进动画队列animateArray
         */
        (function run() {
            if (start > points.length) return;
            var arr = points.slice(start, start + 50);
            arr.forEach(a => {
                a.time = new Date();
            });
            animateArray = animateArray.concat(arr);
            start += 50;
            setTimeout(run, 64);
        })();

        /**
         * 初始化动画
         */
        (function init() {
            var lastPoint = points.slice(-1)[0];
            if (
                animateArray.length == points.length &&
                new Date() - lastPoint.time > lastPoint.duration
            ) {
                animate();
                return;
            }
            stats.begin();
            ctx.clearRect(0, 0, W, H);
            animateArray.forEach((p, i) => {
                p.init();
                p.draw(ctx);
            });
            stats.end();
            requestAnimationFrame(init);
        })();

        /**
         * 监控鼠标动画
         */
        function animate() {
            stats.begin();
            ctx.clearRect(0, 0, W, H);
            animateArray.forEach((p, i) => {
                p.update();
                p.draw(ctx);
            });
            stats.end();
            requestAnimationFrame(animate);
        }
        $('body div:last').css("display","none")
    </script>
    
</body>
</html>
